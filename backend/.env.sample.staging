# Backend staging (Prisma + Postgres)
NODE_ENV=staging
PORT=3000
FRONTEND_URL=https://staging.khadamat.ma
CORS_ORIGINS=https://staging.khadamat.ma
COOKIE_SECURE=true
COOKIE_SAMESITE=lax
DATABASE_URL="postgresql://user:password@db-staging:5432/khadamat"
SHADOW_DATABASE_URL="postgresql://user:password@db-staging-shadow:5432/khadamat_shadow"
JWT_SECRET=change-me-staging
STRIPE_PUBLIC_KEY=pk_test_staging
STRIPE_SECRET_KEY=sk_test_staging
BCRYPT_ROUNDS=12
UPLOAD_STORAGE_DIR=/var/app/uploads
UPLOAD_MAX_MB=25
UPLOAD_ALLOWED_MIME=image/jpeg,image/png,application/pdf
UPLOAD_DRIVER=auto
LOG_LEVEL=info
SENTRY_DSN=https://example.ingest.sentry.io/123
REDIS_URL=redis://redis-staging:6379
MOCK_REDIS=false
HEALTH_READY_DELAY_MS=5000
BACKEND_HEALTH_PATH=/health
BACKEND_WAIT_TIMEOUT_MS=30000
BACKEND_WAIT_RETRY_MS=1000
SMOKE_ROUTES_ENABLE=false
BACKEND_BASE_URL=https://api-staging.khadamat.ma
SMOKE_ADMIN_BEARER=
START_BACKEND_FOR_TESTS=false
START_BACKEND_CMD=auto
APP_VERSION=0.0.0
FORCE_ONLINE=true
OFFLINE_MODE=false
OFFLINE_SKIP_TESTS=false
PRODUCTION_OFFLINE_ALLOWED=false
STAGE=staging
MFA_ENFORCE_ROLES=ADMIN
MFA_WINDOW_SECONDS=30
MFA_DRIFT_STEPS=1
MFA_RATE_LIMIT=5:10m
MFA_REMEMBER_DAYS=30
SMS_ENABLED=true
SMS_PROVIDER=twilio
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_FROM=
VONAGE_API_KEY=
VONAGE_API_SECRET=
VONAGE_FROM=
DEFAULT_COUNTRY=MA
QUIET_HOURS_START=21
QUIET_HOURS_END=8
BOOKING_ACCEPT_WINDOW_HOURS=24
CRON_EXPIRE_SCHEDULE=*/15 * * * *
MAINTENANCE_MODE=false
MAINTENANCE_ALLOW_ADMIN=true
DEMO_ENABLE=false
DEMO_ALLOW_IN_PROD=false
SEED_ADMIN_EMAIL=admin@staging.khadamat.ma
SEED_ADMIN_PASSWORD=ChangeMe_12345
SEED_ADMIN_MFA_SETUP=true
SEED_ADMIN_FIRSTNAME=Admin
SEED_ADMIN_LASTNAME=Staging
DEMO_CLIENT_EMAIL=
DEMO_CLIENT_PASSWORD=
DEMO_PROVIDER_EMAIL=
DEMO_PROVIDER_PASSWORD=
DEMO_PROVIDER_DISPLAY_NAME=
DEMO_PROVIDER_CITY=
DEMO_PROVIDER_LAT=
DEMO_PROVIDER_LNG=
DEMO_PROVIDER_SERVICE_SLUG=
DEMO_MARK_PROVIDER_KYC_VERIFIED=false
MSG_MAX_PER_DAY=200
ATTACH_MAX_PER_DAY=50
USER_MAX_STORAGE_MB=200
LOG_REDACT_PII=true
CLUB_PRO_AMOUNT=50
CURRENCY=mad
BACKUP_ENABLED=true
BACKUP_CRON_SCHEDULE=0 3 * * *
BACKUP_DIR=/var/app/backups
KYC_PROVIDER=stripe
KYC_REQUIRED_FOR=BOTH
KYC_RETENTION_DAYS=30
KYC_HASH_PEPPER=change_me_staging
KYC_STORE_RAW=true
KYC_ENC_KEYRING_JSON={"k1":"20150a6d3769133268174a11409575f9ca08b1630d7d9614690e01325c37fe22"}
KYC_ENC_ACTIVE_KEY_ID=k1
KYC_ENC_ROTATE_AFTER_DAYS=180
KYC_RAW_RETENTION_DAYS=365
KYC_EXPORT_IP_ALLOWLIST=10.0.0.0/24
KYC_EXPORT_RATE_LIMIT=5:15m
ADMIN_TOTP_REQUIRED=true
PRISMA_ENGINES_MIRROR=
PRISMA_ENGINES_CHECKSUM_IGNORE=false
DLQ_ENABLE=true
DLQ_MAX_ATTEMPTS=7
DLQ_BASE_DELAY_SECONDS=60
DLQ_BACKOFF_MULTIPLIER=5
DLQ_POLL_INTERVAL_MS=60000
DLQ_BATCH_SIZE=25
ALERTS_RULES_PATH=deploy/monitoring/rules.yml
ONLINE_TESTS_ENABLE=true
BACKEND_BASE_URL=https://api-staging.khadamat.ma
STRIPE_WEBHOOK_SECRET=whsec_staging
STRIPE_IDENTITY_WEBHOOK_SECRET=whsec_identity_staging
TEST_PROVIDER_EMAIL=provider@staging.khadamat.ma
TEST_PROVIDER_PASSWORD=Provider_12345
GO_LIVE_MAX_DLQ_WEBHOOKS=5
GO_LIVE_MAX_DLQ_SMS=5
GO_LIVE_MAX_HEALTH_LATENCY_MS=800
GO_LIVE_REQUIRE_ALERTS_RULES=true
JOBS_ENABLE=true
JOBS_TZ=Africa/Casablanca
JOBS_DLQ_INTERVAL_MS=60000
JOBS_RETENTION_CRON=0 3 * * *
JOBS_BACKUP_CRON=30 3 * * *
JOBS_HEARTBEAT_CRON=*/5 * * * *
BACKUP_ENABLE=true
BACKUP_RETENTION_DAYS=14
BACKUP_DRIVER=postgres
BACKUP_OUTPUT_DIR=/var/app/backups/tmp
UPLOAD_ANTIVIRUS=true
CLAMAV_HOST=clamav-staging
CLAMAV_PORT=3310
TRUST_PROXY=1
HSTS_ENABLED=true
HSTS_MAX_AGE=15552000
COOKIE_DOMAIN=staging.khadamat.ma
APP_BASE_URL=https://staging.khadamat.ma
