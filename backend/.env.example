PORT=3000
FRONTEND_URL=http://localhost:3000
CORS_ORIGINS=https://khadamat.ma,https://staging.khadamat.ma
COOKIE_SECURE=true
COOKIE_SAMESITE=lax
DATABASE_URL="file:./dev.db"
JWT_SECRET=
STRIPE_PUBLIC_KEY=
STRIPE_SECRET_KEY=sk_test_...
BCRYPT_ROUNDS=12
UPLOAD_STORAGE_DIR=./uploads
UPLOAD_MAX_MB=10
UPLOAD_ALLOWED_MIME=image/jpeg,image/png,application/pdf
UPLOAD_DRIVER=auto   # auto | multer | express-fileupload
# Logging & monitoring
LOG_LEVEL=info
SENTRY_DSN=
REDIS_URL=
HEALTH_READY_DELAY_MS=0
BACKEND_HEALTH_PATH=/health
BACKEND_WAIT_TIMEOUT_MS=15000
BACKEND_WAIT_RETRY_MS=1000
# Activer les routes de smoke internes (jamais en prod)
SMOKE_ROUTES_ENABLE=false

# Base URL API pour smoke HTTP (facultatif)
BACKEND_BASE_URL=http://localhost:3000

# Token admin bearer pour smoke HTTP (facultatif – si vous en avez un)
SMOKE_ADMIN_BEARER=
START_BACKEND_FOR_TESTS=false
START_BACKEND_CMD=auto
APP_VERSION=0.0.0
FORCE_ONLINE=true
OFFLINE_MODE=false
OFFLINE_SKIP_TESTS=true
PRODUCTION_OFFLINE_ALLOWED=false
STAGE=dev
MFA_ENFORCE_ROLES=ADMIN
MFA_WINDOW_SECONDS=30
MFA_DRIFT_STEPS=1
MFA_RATE_LIMIT=5:10m
MFA_REMEMBER_DAYS=30
# Notifications web: rien de spécial (DB only)

# --- SMS (activer/désactiver + provider) ---
SMS_ENABLED=true
SMS_PROVIDER=twilio                # ou: vonage

# Twilio
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_FROM=+212XXXXXXXX          # E.164

# Vonage
VONAGE_API_KEY=
VONAGE_API_SECRET=
VONAGE_FROM=Khadamat              # 11 chars max (selon pays)

# Confort (optionnel)
DEFAULT_COUNTRY=MA
QUIET_HOURS_START=21
QUIET_HOURS_END=8
# Auto-expiration des réservations
BOOKING_ACCEPT_WINDOW_HOURS=24
CRON_EXPIRE_SCHEDULE=*/15 * * * *   # toutes les 15 minutes

# Mode maintenance
MAINTENANCE_MODE=false
MAINTENANCE_ALLOW_ADMIN=true

# Provisioning sécurisé (dev/staging uniquement)
DEMO_ENABLE=true                 # doit être true pour autoriser les scripts demo:* (sinon scripts refusés)
DEMO_ALLOW_IN_PROD=false         # empêche l’exécution en production

# Admin à créer (obligatoire)
SEED_ADMIN_EMAIL=admin@example.com
SEED_ADMIN_PASSWORD=ChangeMe_12345
SEED_ADMIN_MFA_SETUP=true        # true => génère et affiche un secret TOTP (QR/otpauth) pour l’admin
SEED_ADMIN_FIRSTNAME=Admin
SEED_ADMIN_LASTNAME=Root

# Comptes de test (client & prestataire)
DEMO_CLIENT_EMAIL=client@example.com
DEMO_CLIENT_PASSWORD=Client_12345
DEMO_PROVIDER_EMAIL=pro@example.com
DEMO_PROVIDER_PASSWORD=Pro_12345

# Méta prestataire (facultatif mais conseillé)
DEMO_PROVIDER_DISPLAY_NAME="Plombier Test"
DEMO_PROVIDER_CITY="Casablanca"
DEMO_PROVIDER_LAT=33.573110
DEMO_PROVIDER_LNG=-7.589843
DEMO_PROVIDER_SERVICE_SLUG=plomberie   # un slug du catalogue 30 services

# KYC dev-only (si KYC requis pour PROVIDER)
DEMO_MARK_PROVIDER_KYC_VERIFIED=true

# Quotas anti-abus
MSG_MAX_PER_DAY=200
ATTACH_MAX_PER_DAY=50
USER_MAX_STORAGE_MB=200

# Journaux
LOG_REDACT_PII=true

# Club Pro (optionnel pour tester le paiement)
STRIPE_SECRET_KEY=sk_test_...
CLUB_PRO_AMOUNT=50
CURRENCY=mad

# Backups
BACKUP_ENABLED=true
BACKUP_CRON_SCHEDULE=0 3 * * *      # tous les jours à 03:00
BACKUP_DIR=./backups

# KYC configuration
KYC_PROVIDER=stripe
# STRIPE_SECRET_KEY is defined above
KYC_REQUIRED_FOR=BOTH            # PROVIDER | CLIENT | BOTH
KYC_RETENTION_DAYS=30
KYC_HASH_PEPPER=change_me_long_random
# Activer stockage brut chiffré
KYC_STORE_RAW=true

# Keyring de chiffrement (master keys hex 32 bytes = 64 hex chars)
# Exemple: {"k1":"<64 hex>"}
KYC_ENC_KEYRING_JSON={"k1":"20150a6d3769133268174a11409575f9ca08b1630d7d9614690e01325c37fe22"}
KYC_ENC_ACTIVE_KEY_ID=k1
KYC_ENC_ROTATE_AFTER_DAYS=180

# Retention (purge du brut chiffré) hors legal hold
KYC_RAW_RETENTION_DAYS=365

# Export légal: sécurité
KYC_EXPORT_IP_ALLOWLIST=127.0.0.1,::1
KYC_EXPORT_RATE_LIMIT=5:15m        # 5 requêtes par 15 minutes
ADMIN_TOTP_REQUIRED=false          # exige OTP admin (si 2FA disponible)
PRISMA_ENGINES_MIRROR=https://binaries.prisma.sh/all
PRISMA_ENGINES_CHECKSUM_IGNORE=true    # dev uniquement (désactiver en CI/prod)
# PRISMA_SKIP_POSTINSTALL_GENERATE=true  # si postinstall doit être silencieux en CI
# Dead Letter Queue
DLQ_ENABLE=true
DLQ_MAX_ATTEMPTS=7
DLQ_BASE_DELAY_SECONDS=60
DLQ_BACKOFF_MULTIPLIER=5
DLQ_POLL_INTERVAL_MS=60000
DLQ_BATCH_SIZE=25

# Alerting
ALERTS_RULES_PATH=deploy/monitoring/rules.yml

# Online tests (staging)
ONLINE_TESTS_ENABLE=false
BACKEND_BASE_URL=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_IDENTITY_WEBHOOK_SECRET=
TEST_PROVIDER_EMAIL=
TEST_PROVIDER_PASSWORD=
